- name: "Creates directory"
  file:
    path: "/home/ubuntu/server"
    state: "directory"
    mode: 0755

- name: "Copy compressed app folder"
  copy:
    src: "artifact-app.tar.gz"
    dest: "/home/ubuntu/server/artifact-app.tar.gz"

- name: "Extract app"
  unarchive:
    remote_src: yes
    src: "/home/ubuntu/server/artifact-app.tar.gz"
    dest: "/home/ubuntu/server"

- name: Pull image search image
  community.docker.docker_image:
    name: "{{ image_search_image }}"
    tag: "{{ image_search_tag }}"
    source: pull

- name: Pull text search image
  community.docker.docker_image:
    name: "{{ text_search_image }}"
    tag: "{{ text_search_tag }}"
    source: pull

- name: Pull backend image
  community.docker.docker_image:
    name: "{{ backend_image }}"
    tag: "{{ backend_tag }}"
    source: pull

- name: Pull frontend image
  community.docker.docker_image:
    name: "{{ frontend_image }}"
    tag: "{{ frontend_tag }}"
    source: pull

- name: Run docker compose
  become: True
  shell:
    chdir: /home/ubuntu/server
    cmd: "docker compose up -d"
